<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Combined Gas Law (Flow to Nm³/h & Sm³/h)</title>
  <meta name="description" content="Convert actual gas flow (m³/h) at operating conditions to Normal (0°C) and Standard (15°C) conditions using the Combined Gas Law." />

  <!-- Usa SOLO il CSS globale -->
  <link rel="stylesheet" href="/css/styles.css" />
  <script defer src="/js/site.js"></script>
</head>

<body>
  <div id="site-header"></div>

  <section class="hero">
    <div class="wrap">
      <a class="crumb-back" href="/tools/conversions/index.html">← Back to Conversions</a>
      <h1>Combined Gas Law</h1>
      <p>
        Convert an <strong>actual gas volumetric flow</strong> at operating conditions to:
        <strong>Nm³/h</strong> (0&nbsp;°C) and <strong>Sm³/h</strong> (15&nbsp;°C), both at <strong>1.01325 bar(a)</strong>.
      </p>
      <p class="muted">
        Assumes ideal gas, same amount of gas (same moles), and dry gas (no water vapor correction).
      </p>
    </div>
  </section>

  <main class="wrap">

    <!-- TOP: Inputs + Results affiancati (solo classi globali) -->
    <div class="grid">
      <!-- Inputs card -->
      <section class="card">
        <div class="tag">Calculator</div>
        <h2>Inputs</h2>

        <label for="p1">P1 (gauge)</label>
        <div class="hint">bar(g) — operating pressure</div>
        <input id="p1" type="number" step="0.001" value="20" />

        <label for="t1">T1</label>
        <div class="hint">°C — operating temperature</div>
        <input id="t1" type="number" step="0.1" value="50" />

        <label for="q1">Q1 (actual volumetric flow)</label>
        <div class="hint">m³/h at (P1, T1)</div>
        <input id="q1" type="number" step="0.01" value="90" />

        <label for="patm">Atmospheric pressure</label>
        <div class="hint">mbar(a) — used to convert bar(g) → bar(a)</div>
        <input id="patm" type="number" step="0.1" value="998" />

        <div class="note">
          <div><strong>Defaults used</strong></div>
          <div>Pref = <code>1.01325</code> bar(a)</div>
          <div>Tnormal = <code>273.15</code> K (0°C)</div>
          <div>Tstandard = <code>288.15</code> K (15°C)</div>
        </div>
      </section>

      <!-- Results card -->
      <section class="card">
        <div class="tag">Results</div>
        <h2>Converted flows</h2>

        <div class="result">
          Flow (Nm³/h): <span id="outN">—</span>
          <div class="hint" id="outNdetail"></div>
        </div>

        <div class="result">
          Flow (Sm³/h): <span id="outS">—</span>
          <div class="hint" id="outSdetail"></div>
        </div>

        <div class="note">
          <strong>Formula usata con i tuoi numeri</strong>
          <div class="hint" id="formulaN"></div>
          <div class="hint" id="formulaS"></div>
        </div>

        <div class="note">
          <strong>Sanity check</strong><br/>
          Higher pressure → higher Nm³/h &amp; Sm³/h for the same actual m³/h.<br/>
          Higher temperature → lower Nm³/h &amp; Sm³/h for the same actual m³/h.
        </div>
      </section>
    </div>

    <!-- BOTTOM: Explanation (solo classi globali) -->
    <section class="card" style="margin-top:14px;">
      <div class="tag">Gas / Units</div>
      <h2>Where do the formulas come from?</h2>

      <p>For an ideal gas:</p>
      <div class="out">
        <code>(P₁ · V₁) / T₁ = (P₂ · V₂) / T₂</code>
      </div>

      <p>If you solve for the reference volume:</p>
      <div class="out">
        <code>V₂ = V₁ · (P₁ / P₂) · (T₂ / T₁)</code>
      </div>

      <h2>Final conversion (flow)</h2>
      <p class="hint">If <code>Q₁</code> is your actual volumetric flow (m³/h) at (P₁, T₁):</p>
      <div class="out">
        <code>Qref = Q₁ · (P₁_abs / Pref) · (Tref / T₁_abs)</code>
      </div>
    </section>

  </main>

  <div id="site-footer"></div>

  <script>
    (function(){
      const el = (id) => document.getElementById(id);

      const p1 = el("p1");
      const t1 = el("t1");
      const q1 = el("q1");
      const patm = el("patm");

      const outN = el("outN");
      const outS = el("outS");
      const outNdetail = el("outNdetail");
      const outSdetail = el("outSdetail");
      const formulaN = el("formulaN");
      const formulaS = el("formulaS");

      const P_REF = 1.01325;
      const T_N = 273.15;
      const T_S = 288.15;

      function toNumber(x){
        const n = Number(x);
        return Number.isFinite(n) ? n : NaN;
      }
      function fmt(x){
        if (!Number.isFinite(x)) return "—";
        return x.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      // <-- QUI il tuo calc() IDENTICO
      function calc(){
        const P1_g = toNumber(p1.value);         // bar(g)
        const T1_c = toNumber(t1.value);         // °C
        const Q1 = toNumber(q1.value);           // m³/h
        const Patm_mbar = toNumber(patm.value);  // mbar(a)

        if (![P1_g, T1_c, Q1, Patm_mbar].every(Number.isFinite)){
          outN.textContent = "—";
          outS.textContent = "—";
          outNdetail.textContent = "";
          outSdetail.textContent = "";
          formulaN.textContent = "";
          formulaS.textContent = "";
          return;
        }

        const Patm_bar = Patm_mbar / 1000.0;     // bar(a)
        const P1_abs = P1_g + Patm_bar;          // bar(a)
        const T1_abs = T1_c + 273.15;            // K

        const QN = Q1 * (P1_abs / P_REF) * (T_N / T1_abs);
        const QS = Q1 * (P1_abs / P_REF) * (T_S / T1_abs);

        outN.textContent = fmt(QN);
        outS.textContent = fmt(QS);

        const Q1s = Q1.toFixed(2);
        const P1absS = P1_abs.toFixed(3);
        const PrefS = P_REF.toFixed(5);
        const TnS = T_N.toFixed(2);
        const TsS = T_S.toFixed(2);
        const T1absS = T1_abs.toFixed(2);

        formulaN.textContent =
          `QN = ${Q1s} * (${P1absS}/${PrefS}) * (${TnS}/${T1absS}) = ${fmt(QN)} Nm³/h`;

        formulaS.textContent =
          `QS = ${Q1s} * (${P1absS}/${PrefS}) * (${TsS}/${T1absS}) = ${fmt(QS)} Sm³/h`;

        outNdetail.textContent = `Using P1_abs=${P1_abs.toFixed(3)} bar(a), T1_abs=${T1_abs.toFixed(2)} K`;
        outSdetail.textContent = `Using P1_abs=${P1_abs.toFixed(3)} bar(a), T1_abs=${T1_abs.toFixed(2)} K`;
      }

      [p1, t1, q1, patm].forEach(i => i.addEventListener("input", calc));
      calc();
    })();
  </script>
</body>
</html>

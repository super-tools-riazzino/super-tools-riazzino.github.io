<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Combined Gas Law (Flow to Nm³/h &amp; Sm³/h)</title>
  <meta name="description" content="Convert actual gas flow (m³/h) at operating conditions to Normal (0°C) and Standard (15°C) conditions using the Combined Gas Law." />

  <!-- SOLO CSS globale -->
  <link rel="stylesheet" href="/css/styles.css" />
  <script defer src="/js/site.js"></script>
</head>

<body>
  <div id="site-header"></div>

  <section class="hero">
    <div class="wrap">
      <a class="crumb-back" href="/tools/conversions/index.html">← Back to Conversions</a>
      <h1>Combined Gas Law</h1>
      <p>
        Convert an <strong>actual gas volumetric flow</strong> at operating conditions to:
        <strong>Nm³/h</strong> (Normal: 0&nbsp;°C) and <strong>Sm³/h</strong> (Standard: 15&nbsp;°C),
        both at <strong>1.01325 bar(a)</strong>.
      </p>
      <p class="muted">
        Assumes ideal gas, same amount of gas (same moles), and dry gas (no water vapor correction).
      </p>
    </div>
  </section>

  <main class="wrap">

    <!-- TOP: Inputs + Results (sempre sopra) -->
    <div class="grid">
      <!-- Inputs -->
      <section class="card">
        <div class="tag">Calculator</div>
        <h2>Inputs</h2>

        <label for="p1">P1 (gauge)</label>
        <div class="hint">bar(g) — operating pressure</div>
        <input id="p1" type="number" step="0.001" value="20" />

        <label for="t1">T1</label>
        <div class="hint">°C — operating temperature</div>
        <input id="t1" type="number" step="0.1" value="50" />

        <label for="q1">Q1 (actual volumetric flow)</label>
        <div class="hint">m³/h at (P1, T1)</div>
        <input id="q1" type="number" step="0.01" value="90" />

        <label for="patm">Atmospheric pressure</label>
        <div class="hint">mbar(a) — used to convert bar(g) → bar(a)</div>
        <input id="patm" type="number" step="0.1" value="998" />

        <div class="note">
          <div><strong>Defaults used</strong></div>
          <div>Pref = <code>1.01325</code> bar(a)</div>
          <div>Tnormal = <code>273.15</code> K (0°C)</div>
          <div>Tstandard = <code>288.15</code> K (15°C)</div>
        </div>
      </section>

      <!-- Results -->
      <section class="card">
        <div class="tag">Results</div>
        <h2>Converted flows</h2>

        <div class="result">
          Flow (Nm³/h): <span id="outN">—</span>
          <div class="hint" id="outNdetail"></div>
        </div>

        <div class="result">
          Flow (Sm³/h): <span id="outS">—</span>
          <div class="hint" id="outSdetail"></div>
        </div>

        <div class="section-title" style="margin:16px 0 6px;">Formula usata con i tuoi numeri</div>
        
        <div class="out">
          <div><strong>Nm³/h</strong></div>
          <code id="outNformula">—</code>
        </div>
        
        <div class="out">
          <div><strong>Sm³/h</strong></div>
          <code id="outSformula">—</code>
        </div>

        <div class="note">
          <strong>Sanity check</strong><br/>
          Higher pressure → higher Nm³/h &amp; Sm³/h for the same actual m³/h.<br/>
          Higher temperature → lower Nm³/h &amp; Sm³/h for the same actual m³/h.
        </div>
      </section>
    </div>

    <!-- BOTTOM: Spiegazioni (sempre sotto) -->
    <div class="section-title">Explanation</div>

    <section class="card">
      <div class="tag">Gas / Units</div>
      <h2>Where do the formulas come from?</h2>

      <p>
        For an ideal gas, the relationship between pressure, volume and temperature (in Kelvin) is:
      </p>
      <div class="out">
        <code>(P₁ · V₁) / T₁ = (P₂ · V₂) / T₂</code>
      </div>

      <p>
        If you keep the same gas amount and move from operating conditions (index 1) to reference conditions (index 2),
        you can solve for the reference volume:
      </p>
      <div class="out">
        <code>V₂ = V₁ · (P₁ / P₂) · (T₂ / T₁)</code>
      </div>

      <h2>Important unit points</h2>
      <ul>
        <li>
          <strong>Temperature must be absolute</strong>: <code>T[K] = T[°C] + 273.15</code>
        </li>
        <li>
          <strong>Pressure must be absolute</strong>: you enter <code>P₁</code> as <code>bar(g)</code> (gauge). Convert with:
          <div class="out"><code>P₁_abs[bar(a)] = P₁_barg + P_atm_bar(a)</code></div>
          where <code>P_atm</code> is typically around 1013 mbar(a), but can be measured locally.
        </li>
        <li>
          Reference pressure used here: <code>P_ref = 1.01325 bar(a)</code>
        </li>
        <li>
          Reference temperatures:
          <ul>
            <li><strong>Normal</strong>: <code>0 °C → 273.15 K</code> → <strong>Nm³/h</strong></li>
            <li><strong>Standard</strong>: <code>15 °C → 288.15 K</code> → <strong>Sm³/h</strong></li>
          </ul>
        </li>
      </ul>

      <h2>Final conversion (flow)</h2>
      <p class="hint">
        If <code>Q₁</code> is your actual volumetric flow (m³/h) at (<code>P₁</code>, <code>T₁</code>), then:
      </p>
      <div class="out">
        <code>Qref = Q₁ · (P₁_abs / Pref) · (Tref / T₁_abs)</code>
      </div>

      <p class="hint">
        Note: we apply the same relationship to a <strong>flow rate</strong> (m³/h) because it’s volume per unit time.
      </p>
    </section>

  </main>

  <div id="site-footer"></div>

  <script>
    (function(){
      const el = (id) => document.getElementById(id);

      const p1 = el("p1");
      const t1 = el("t1");
      const q1 = el("q1");
      const patm = el("patm");

      const outN = el("outN");
      const outS = el("outS");
      const outNdetail = el("outNdetail");
      const outSdetail = el("outSdetail");

      // Constants
      const P_REF = 1.01325;     // bar(a)
      const T_N = 273.15;        // K (0°C)
      const T_S = 288.15;        // K (15°C)

      function toNumber(x){
        const n = Number(x);
        return Number.isFinite(n) ? n : NaN;
      }

      function fmt(x){
        if (!Number.isFinite(x)) return "—";
        return x.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      function calc(){
        const P1_g = toNumber(p1.value);         // bar(g)
        const T1_c = toNumber(t1.value);         // °C
        const Q1 = toNumber(q1.value);           // m³/h
        const Patm_mbar = toNumber(patm.value);  // mbar(a)

        if (![P1_g, T1_c, Q1, Patm_mbar].every(Number.isFinite)){
          outN.textContent = "—";
          outS.textContent = "—";
          outNdetail.textContent = "";
          outSdetail.textContent = "";
          return;
        }

        const Patm_bar = Patm_mbar / 1000.0;     // bar(a)
        const P1_abs = P1_g + Patm_bar;          // bar(a)
        const T1_abs = T1_c + 273.15;            // K

        // Qref = Q1 * (P1_abs / Pref) * (Tref / T1_abs)
        const QN = Q1 * (P1_abs / P_REF) * (T_N / T1_abs);
        const QS = Q1 * (P1_abs / P_REF) * (T_S / T1_abs);

        outN.textContent = fmt(QN);
        outS.textContent = fmt(QS);

        outNdetail.textContent = `Using P1_abs=${P1_abs.toFixed(3)} bar(a), T1_abs=${T1_abs.toFixed(2)} K`;
        outSdetail.textContent = `Using P1_abs=${P1_abs.toFixed(3)} bar(a), T1_abs=${T1_abs.toFixed(2)} K`;
    
        const outNformula = el("outNformula");
        const outSformula = el("outSformula");

        function fnum(x, d){
          if (!Number.isFinite(x)) return "—";
          return x.toFixed(d);
              }
              
              // ...dentro calc(), DOPO aver calcolato QN e QS:
              const q1s = fnum(Q1, 2);
              const pabs = fnum(P1_abs, 3);
              const pref = fnum(P_REF, 5);
              const tn = fnum(T_N, 2);
              const ts = fnum(T_S, 2);
              const t1a = fnum(T1_abs, 2);
              
              outNformula.textContent =
                `QN = ${q1s}*(${pabs}/${pref})*(${tn}/${t1a}) = ${fnum(QN, 2)}`;
              
              outSformula.textContent =
                `QS = ${q1s}*(${pabs}/${pref})*(${ts}/${t1a}) = ${fnum(QS, 2)}`;
      }

      [p1, t1, q1, patm].forEach(i => i.addEventListener("input", calc));
      calc();
    })();
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SCOPX ACS Technical Notes</title>
  <meta name="description" content="SCOPX ACS Technical Notes - standardized short/long descriptions for ACS selections." />

  <!-- Shared stylesheet -->
  <link rel="stylesheet" href="/css/styles.css" />
  <script defer src="/js/site.js"></script>

  <style>
    /* Piccole utility locali (minime) per tabella + modal, senza toccare styles.css */
    .toolbar { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin: 14px 0; }
    .toolbar input[type="search"], .toolbar select {
      padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03); color: inherit; min-width: 220px;
    }
    .toolbar .meta { opacity:.8; font-size:.9rem; margin-left:auto; }

    .table-wrap { overflow:auto; border-radius: 14px; border: 1px solid rgba(255,255,255,.10); }
    table { width:100%; border-collapse: collapse; min-width: 920px; }
    th, td { padding: 12px 12px; border-bottom: 1px solid rgba(255,255,255,.08); vertical-align: top; }
      /* Sticky header: keep column titles visible while scrolling */
      .table-wrap thead th {
        position: sticky;
        top: 0;
        z-index: 5;
        background: rgba(20,20,22,.98);      /* stesso “tono” del sito */
        border-bottom: 1px solid rgba(255,255,255,.14);
      }
      
      /* opzionale: evita che sotto si veda il contenuto mentre scorre */
      .table-wrap thead tr {
        background: rgba(20,20,22,.98);
      }
    th { text-align:left; white-space: nowrap; cursor: pointer; user-select:none; }
    th .sort { opacity:.6; margin-left:6px; font-size:.85em; }
    td code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:.95em; }

    .btn-sm {
      display:inline-block; padding: 8px 10px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04);
      text-decoration:none; color: inherit;
    }
    .btn-sm:hover { background: rgba(255,255,255,.07); }

    /* Modal */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center; padding: 18px;
      z-index: 9999;
    }
    .modal {
      width: min(980px, 100%); max-height: 85vh; overflow:auto;
      border-radius: 16px; border: 1px solid rgba(255,255,255,.12);
      background: rgba(20,20,22,.98); padding: 16px 16px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .modal header { display:flex; align-items:flex-start; gap:12px; }
    .modal h3 { margin: 0; }
    .modal .close { margin-left:auto; }
    .kv { display:grid; grid-template-columns: 220px 1fr; gap:10px 14px; margin-top: 12px; }
    .k { opacity:.75; }
    .v { white-space: pre-wrap; }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.12); opacity:.9; }
    .muted { opacity:.75; }
    .warn { margin-top:12px; padding: 10px 12px; border-radius: 12px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); }
  
/* --- Modal readability fix --- */
.modal {
  color: #fff;                 /* testo bianco nel modal */
}

.modal h3,
.modal .v {
  color: #fff;                 /* testo principale */
}

.modal .k,
.modal .muted,
.modal #modalSubtitle {
  color: rgba(255,255,255,.78); /* label e testo secondario leggibile */
}

.modal .pill {
  color: #fff;
}

/* Bottoni dentro al modal (Close / Copy Short / Copy Long) */
.modal .btn-sm {
  color: #fff;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.18);
}

.modal .btn-sm:hover {
  background: rgba(255,255,255,.10);
}

/* Opzionale: migliora leggibilità della riga separatrice (quella gialla) se vuoi mantenerla */
    
  </style>
</head>

<body>
  <div id="site-header"></div>

  <section class="hero">
    <div class="wrap">
      <h1>SCOPX – ACS Technical Notes</h1>
      <p>
        Standardized short/long descriptions for ACS selections. Work in progress: new notes will be added over time.
      </p>
      <div class="note">
        Tip: use Search to find keywords across Group/Index and descriptions. Click a column header to sort.
      </div>
    </div>
  </section>

  <main class="wrap">
    <div class="section-title">PAE</div>

    <div class="toolbar">
      <input id="q" type="search" placeholder="Search (group, index, keywords…)" aria-label="Search notes" />
      <select id="groupFilter" aria-label="Filter by group">
        <option value="">All Groups</option>
      </select>

      <div class="meta" id="count">0 notes</div>
    </div>

    <div class="warn muted">
      Please avoid adding email signatures / confidentiality footers into notes. Keep only the technical content relevant to ACS selections.
    </div>

    <div class="table-wrap" style="margin-top:14px;">
      <table id="notesTable">
        <thead>
          <tr>
            <th data-key="group">GROUP <span class="sort" id="sort-group"></span></th>
            <th data-key="index">INDEX <span class="sort" id="sort-index"></span></th>
            <th data-key="groupDescription">GROUP DESCRIPTION <span class="sort" id="sort-groupDescription"></span></th>
            <th data-key="indexDescription">INDEX DESCRIPTION <span class="sort" id="sort-indexDescription"></span></th>
            <th data-key="shortDescription">SHORT DESCRIPTION <span class="sort" id="sort-shortDescription"></span></th>
            <th>LONG DESCRIPTION</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div style="margin-top:14px;">
      <a class="btn-sm" href="https://github.com/super-tools-riazzino/super-tools-riazzino.github.io/edit/main/data/scopx_acs_notes.json" target="_blank" rel="noopener">
        Edit notes on GitHub →
      </a>
      <span class="muted" style="margin-left:10px;">(fastest way to add/update notes without any database)</span>
    </div>
  </main>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <header>
        <div>
          <div class="pill" id="modalId">GROUP / INDEX</div>
          <h3 id="modalTitle" style="margin-top:10px;">Title</h3>
          <div class="muted" id="modalSubtitle" style="margin-top:6px;"></div>
        </div>
        <a href="#" class="btn-sm close" id="closeBtn">Close</a>
      </header>

      <div class="kv">
        <div class="k">GROUP DESCRIPTION</div><div class="v" id="mGroupDesc"></div>
        <div class="k">INDEX DESCRIPTION</div><div class="v" id="mIndexDesc"></div>
        <div class="k">SHORT DESCRIPTION</div><div class="v" id="mShort"></div>
        <div class="k">LONG DESCRIPTION</div><div class="v" id="mLong"></div>
      </div>

      <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
        <a href="#" class="btn-sm" id="copyShort">Copy Short</a>
        <a href="#" class="btn-sm" id="copyLong">Copy Long</a>
      </div>
    </div>
  </div>

  <script>
    const DATA_URL = "/data/scopx_acs_notes.json";

    let ALL = [];
    let VIEW = [];
    let sortKey = "group";
    let sortDir = "asc";

    const $ = (id) => document.getElementById(id);

    function norm(s) { return (s ?? "").toString().toLowerCase(); }

    function compare(a, b) {
      const av = (a[sortKey] ?? "").toString();
      const bv = (b[sortKey] ?? "").toString();
      const out = av.localeCompare(bv, undefined, { numeric: true, sensitivity: "base" });
      return sortDir === "asc" ? out : -out;
    }

    function updateSortIndicators() {
      const keys = ["group","index","groupDescription","indexDescription","shortDescription"];
      keys.forEach(k => $("sort-" + k).textContent = (k === sortKey ? (sortDir === "asc" ? "▲" : "▼") : ""));
    }

    function populateGroupFilter(items) {
      const sel = $("groupFilter");
      const groups = [...new Set(items.map(x => x.group).filter(Boolean))].sort((a,b)=>a.localeCompare(b, undefined, {numeric:true}));
      groups.forEach(g => {
        const opt = document.createElement("option");
        opt.value = g;
        opt.textContent = g;
        sel.appendChild(opt);
      });
    }

    function applyFilters() {
      const q = norm($("q").value);
      const g = $("groupFilter").value;

      VIEW = ALL.filter(n => {
        if (g && n.group !== g) return false;

        if (!q) return true;

        const hay = [
          n.group, n.index,
          n.groupDescription, n.indexDescription,
          n.shortDescription, n.longDescription
        ].map(norm).join(" ");
        return hay.includes(q);
      });

      VIEW.sort(compare);
      render();
    }

    function render() {
      updateSortIndicators();
      $("count").textContent = `${VIEW.length} notes`;

      const tb = $("tbody");
      tb.innerHTML = "";

      VIEW.forEach((n, i) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td><code>${escapeHtml(n.group)}</code></td>
          <td><code>${escapeHtml(n.index)}</code></td>
          <td>${escapeHtml(n.groupDescription)}</td>
          <td>${escapeHtml(n.indexDescription)}</td>
          <td>${escapeHtml(n.shortDescription)}</td>
          <td>${escapeHtml(shorten(n.longDescription, 140))}</td>
          <td><a class="btn-sm" href="#" data-i="${i}">Details</a></td>
        `;

        tr.querySelector("a").addEventListener("click", (e) => {
          e.preventDefault();
          openModal(n);
        });

        tb.appendChild(tr);
      });
    }

    function shorten(s, max) {
      const t = (s ?? "").toString().trim();
      if (t.length <= max) return t;
      return t.slice(0, max - 1) + "…";
    }

    function escapeHtml(str) {
      return (str ?? "").toString()
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function openModal(n) {
      $("modalId").textContent = `${n.group} / ${n.index}`;
      $("modalTitle").textContent = n.shortDescription || "(no short description)";
      $("modalSubtitle").textContent = `${n.groupDescription || ""} — ${n.indexDescription || ""}`;

      $("mGroupDesc").textContent = n.groupDescription || "";
      $("mIndexDesc").textContent = n.indexDescription || "";
      $("mShort").textContent = n.shortDescription || "";
      $("mLong").textContent = n.longDescription || "";

      $("backdrop").style.display = "flex";
      $("backdrop").setAttribute("aria-hidden", "false");

      $("copyShort").onclick = (e) => { e.preventDefault(); copyText(n.shortDescription || ""); };
      $("copyLong").onclick = (e) => { e.preventDefault(); copyText(n.longDescription || ""); };
    }

    function closeModal(e) {
      if (e) e.preventDefault();
      $("backdrop").style.display = "none";
      $("backdrop").setAttribute("aria-hidden", "true");
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
      } catch {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
      }
    }

    async function init() {
      const res = await fetch(DATA_URL, { cache: "no-store" });
      ALL = await res.json();

      populateGroupFilter(ALL);

      // Sort headers
      document.querySelectorAll("th[data-key]").forEach(th => {
        th.addEventListener("click", () => {
          const key = th.getAttribute("data-key");
          if (sortKey === key) sortDir = (sortDir === "asc" ? "desc" : "asc");
          else { sortKey = key; sortDir = "asc"; }
          applyFilters();
        });
      });

      $("q").addEventListener("input", applyFilters);
      $("groupFilter").addEventListener("change", applyFilters);

      $("closeBtn").addEventListener("click", closeModal);
      $("backdrop").addEventListener("click", (e) => { if (e.target === $("backdrop")) closeModal(e); });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

      applyFilters();
    }

    init().catch(err => {
      console.error(err);
      $("count").textContent = "Error loading notes (check JSON path).";
    });
  </script>

  <div id="site-footer"></div>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>kVA → Current (A) | Super Tools</title>
  <meta name="description" content="Calculate current from kVA, voltage, power factor, and phase." />

  <!-- Shared stylesheet -->
  <link rel="stylesheet" href="../css/styles.css" />
</head>

<body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <span class="dot"></span>
        <span>Super Tools</span>
      </div>
      <nav>
        <a href="../index.html">Home</a>
        <a href="./">Tools</a>
        <a href="../about.html">About</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="wrap">
      <h1>kVA → Current (A)</h1>
      <p>
        Calculate current from apparent power. Works for single-phase or three-phase.
      </p>
    </div>
  </section>

  <main class="wrap">
    <div class="card">
      <div class="grid">
        <div>
          <label for="kva">Apparent power (kVA)</label>
          <input id="kva" type="number" inputmode="decimal" step="any" value="100" />
        </div>

        <div>
          <label for="voltage" id="voltageLabel">Voltage (V)</label>
          <input id="voltage" type="number" inputmode="decimal" step="any" value="400" />
        </div>

        <div>
          <label for="pf">Power factor (PF)</label>
          <input id="pf" type="number" inputmode="decimal" step="any" value="0.95" />
        </div>

        <div>
          <label for="phase">System</label>
          <select id="phase">
            <option value="3">Three-phase (√3)</option>
            <option value="1">Single-phase</option>
          </select>
        </div>
      </div>

      <div class="row">
        <button class="btn" id="calcBtn">Calculate</button>
        <button class="btn secondary" id="resetBtn" type="button">Reset</button>
      </div>

      <div class="result" id="result" role="status" aria-live="polite">Result: —</div>

      <div class="hint">
        Formula used:<br/>
        <code>I(A) = kVA × 1000 / ( V × √3 × PF )</code> for three-phase<br/>
        <code>I(A) = kVA × 1000 / ( V × PF )</code> for single-phase
      </div>
    </div>
  </main>

  <footer>
    <div class="wrap">
      <div style="font-weight:900; font-size:1.05rem;">Super Tools</div>
      <div class="muted">Educational & utility calculators. Runs entirely in your browser.</div>
    </div>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);

    function num(id){
      const v = parseFloat($(id).value);
      return Number.isFinite(v) ? v : NaN;
    }

    function formatA(x){
      // show 2 decimals for small currents, 1 for medium, 0 for large
      const ax = Math.abs(x);
      const dec = ax < 10 ? 2 : (ax < 100 ? 1 : 0);
      return x.toFixed(dec);
    }

    let lastDefaultVoltage = null;
    
    function getDefaultVoltage(phase){
      return phase === "3" ? 400 : 230; // 3φ tipico L-L 400V, 1φ tipico L-N 230V
    }
    
    function updateVoltageLabel(phase){
      const lbl = $("voltageLabel");
      if(!lbl) return;
      lbl.textContent = phase === "3"
        ? "Voltage (V) — line-to-line (L-L)"
        : "Voltage (V) — line-to-neutral (L-N)";
    }
    
    /**
     * Applica il default di tensione quando cambia la fase.
     * Non sovrascrive un valore custom: aggiorna solo se il valore attuale
     * è vuoto oppure coincide con l’ultimo default applicato.
     */
    function applyPhaseDefaults(){
      const phase = $("phase").value; // "3" o "1"
      const defV = getDefaultVoltage(phase);
    
      updateVoltageLabel(phase);
    
      const vEl = $("voltage");
      vEl.value = defV;          // <-- SEMPRE default quando cambia fase
      lastDefaultVoltage = defV;
    }

    function calculate(){
      const kva = num("kva");
      const V = num("voltage");
      const pf = num("pf");
      const phase = $("phase").value; // "3" or "1"

      if(!Number.isFinite(kva) || !Number.isFinite(V) || !Number.isFinite(pf)){
        $("result").textContent = "Result: please enter valid numbers.";
        return;
      }
      if(V <= 0){
        $("result").textContent = "Result: voltage must be > 0.";
        return;
      }
      if(pf <= 0 || pf > 1){
        $("result").textContent = "Result: PF must be between 0 and 1.";
        return;
      }

      const VA = kva * 1000;
      const denom = phase === "3" ? (V * Math.sqrt(3) * pf) : (V * pf);
      const I = VA / denom;

      $("result").textContent = `Result: ${formatA(I)} A`;
    }

    function resetForm(){
      $("kva").value = 100;
      $("pf").value = 0.95;
      $("phase").value = "3";
    
      applyPhaseDefaults();          // setta 400 e label corretta
      $("result").textContent = "Result: —";
      calculate();
    }

    $("calcBtn").addEventListener("click", calculate);
    $("phase").addEventListener("change", () => {
      applyPhaseDefaults();
      calculate();
    });
    $("resetBtn").addEventListener("click", resetForm);

    // auto-calc on enter
    ["kva","voltage","pf"].forEach(id=>{
      $(id).addEventListener("keydown", (e)=>{
        if(e.key === "Enter") calculate();
      });
    });

    // initial
    applyPhaseDefaults(true);
    calculate();
  </script>
</body>
</html>
